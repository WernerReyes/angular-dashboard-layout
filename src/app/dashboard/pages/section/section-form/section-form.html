<p-dialog
    [header]="selectedSection() ? 'Editar sección' : 'Crear nueva sección'"
    class="!overflow-hidden"
    [visible]="display()"
    (visibleChange)="onCloseDialog.emit()"
    [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
    [style]="{ width: '30vw' }"
    [modal]="true"
    [maximizable]="true"
    (onHide)="closeDialog()"
>
    <form class="flex flex-col gap-4" [formGroup]="form" id="menu-form" (ngSubmit)="saveChanges()">
        @let type = form.controls['type'].value;
        <div class="flex flex-col gap-2">
            <label for="type">Tipo</label>
            <p-select
                id="type"
                [overlayOptions]="{
                    mode: 'modal'
                }"
                formControlName="type"
                [options]="sectionTypesOptions | keyvalue"
                optionLabel="value.label"
                optionValue="value.value"
                placeholder="Selecciona el tipo de sección"
            ></p-select>
            @if (form.controls['type'].errors) {
            <p-message severity="error" size="small" variant="simple"> {{ FormUtils.getFieldError(form, 'type') }} </p-message>
            }
        </div>

        <div class="flex flex-col gap-2 w-full">
            <common-inputs [form]="form" [includeFields]="[{ type: 'title', label: 'Título', placeholder: 'Título de la sección' }]"></common-inputs>

            @switch (type) { @case (SectionType.WHY_US) { <why-us-form [form]="form"></why-us-form>
            } @case (SectionType.CASH_PROCESSING_EQUIPMENT) {
            <div class="mt-3">
                <show-link-switch [form]="form"></show-link-switch>
            </div>
            } @case (SectionType.CLIENT) {
            <common-inputs
                [form]="form"
                [includeFields]="[{
                type: 'subtitle',
                label: 'Subtítulo',
                placeholder: 'Subtítulo de la sección',
            }]"
            ></common-inputs>
            } @case (SectionType.OUR_COMPANY) {
                @let imageType = form.controls['imageType'].value;
            <common-inputs
                [form]="form"
                [includeFields]="[{
                    type: 'content',
                    label: 'Historia',
                    placeholder: 'Breve historia de la empresa',
                    isTextarea: true,
                    }]"
            ></common-inputs>
            <div class="flex flex-col gap-2">
                <label>Imagen referencial</label>
                <file-upload
                    currentImageName="currentImage"
                    imageSelector="image"
                    [form]="form"
                    label="URL de la imagen"
                    imageTypeName="imageType"
                    [imageType]="imageType"
                    imageFieldName="imageFile"
                    imageURLName="imageUrl"
                >
                </file-upload>
            </div>
            } @case(SectionType.MAIN_NAVIGATION_MENU) {
              <main-navigation-menu-form></main-navigation-menu-form>
            }
        
        }
                    
            
        </div>

        <p-togglebutton formControlName="active" onLabel="Activo" offLabel="Inactivo" onIcon="pi pi-check" offIcon="pi pi-times" onIcon="pi pi-lock-open" offIcon="pi pi-lock" class="w-36" ariaLabel="Do you confirm" />
    </form>

    <!-- TODO: <pre>{{ form.value | json }}</pre> -->

    <ng-template #footer>
        <button pButton type="submit" form="menu-form" icon="pi pi-save" [disabled]="form.invalid" label="Guardar"></button>
    </ng-template>
</p-dialog>
