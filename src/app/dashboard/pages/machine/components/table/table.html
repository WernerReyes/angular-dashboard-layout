<app-error-boundary [resource]="categoriesList" emptyMessage="No hay máquinas disponibles." errorMessage="Hubo un error al cargar las máquinas.">
    <ng-template #content let-categories>
        <p-confirm-dialog />
        <p-contextmenu #cm [model]="items" (onHide)="selectedCategory.set(null)" />
        <p-table [value]="categories" [(contextMenuSelection)]="selectedCategory" [contextMenu]="cm" sortField="title" sortMode="single" dataKey="id" rowGroupMode="subheader" groupRowsBy="id" [tableStyle]="{'min-width': '70rem'}">
            <ng-template #header>
                <tr>
                    <th style="width: 20%">Nombre</th>
                    <th style="width: 20%">Breve Descripción</th>
                    <th style="width: 20%">Descripción completa</th>
                    <th style="width: 20%">Imagenes</th>
                    <th style="width: 20%">Especificaciones Técnicas</th>
                    <th style="width: 20%">Creación</th>
                    <th style="width: 20%">Última Modificación</th>
                </tr>
            </ng-template>
            <ng-template #groupheader let-category let-rowIndex="rowIndex" let-expanded="expanded">
                <tr [pContextMenuRow]="category">
                    <td colspan="7" class="w-full">
                        <button type="button" pButton pRipple [pRowToggler]="category" text rounded plain class="mr-2" [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></button>
                        @let type = getType(category.type);

                        <span class="font-bold ml-2">{{category.title}}</span>

                        <p-tag class="ml-4" [value]="type.label" [severity]="type.severity" [icon]="type.icon"></p-tag>
                    </td>
                </tr>
            </ng-template>
            <ng-template #groupfooter let-category>
                <tr class="p-rowgroup-footer">
                    <td colspan="6" style="text-align: right">Total de máquinas</td>
                    <!-- <td>{{calculateCustomerTotal(customer.representative.name)}}</td> -->
                    <td>{{category.machines.length}}</td>
                </tr>
            </ng-template>
            <ng-template #expandedrow let-category>
                @let machines = category.machines; @if (machines.length === 0) {
                <tr>
                    <td colspan="7" class="text-center">No hay máquinas en esta categoría.</td>
                </tr>
                } @else { hola }
            </ng-template>
        </p-table>

        <machine-dialog-form [(display)]="dialogMachine"></machine-dialog-form>
    </ng-template>
</app-error-boundary>
