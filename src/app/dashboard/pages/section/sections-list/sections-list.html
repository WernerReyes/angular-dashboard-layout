@if (selectedPage()) {

<app-error-boundary [resource]="sectionList" [errorMessage]="'No se pudieron cargar las secciones.'" [emptyMessage]="'No hay secciones disponibles.'">
    <ng-template #loading>
        <app-data-view-skeleton></app-data-view-skeleton>
    </ng-template>

    <ng-template #content let-sections>
        @let filteredSections = sections | filterSectionsByPage:selectedPage()!.id;

        <div class="mt-4 flex flex-col gap-4">
            @if (filteredSections.length === 0) {
            <div class="flex flex-col items-center justify-center py-8 text-surface-500">
                <i class="pi pi-inbox text-4xl mb-3"></i>
                <div class="font-semibold text-lg mb-1">No se encontraron secciones</div>
                <div class="text-sm">Intenta ajustar tu búsqueda o crea una nueva sección para comenzar.</div>
            </div>

            } @else {
            <div cdkDropList [cdkDropListData]="filteredSections" (cdkDropListDropped)="drop($event, filteredSections)" class="flex flex-col gap-4">
                @if (hasPositionChanged()) {
                <p-message (onClose)="cancelChanges()" severity="info" class="mb-4 w-full" [closable]="true">
                    <ng-template #icon>
                        <p-button (click)="savePositionChanges()" label="Guardar cambios" text class="ml-2" icon="pi pi-save" severity="info"></p-button>
                    </ng-template>
                    <div class="flex items-center justify-between">
                        <span class="ml-2">Has cambiado el orden de las secciones</span>
                        <div></div>
                    </div>
                </p-message>
                } @for (section of filteredSections; track section.id) { @let status = sectionStatusOptions[`${section.active}`]; @let typeOption = sectionTypesOptions[section.type];
                <div class="bg-white dark:bg-surface-800 rounded-lg border border-surface-200 dark:border-surface-700 p-5" cdkDrag>
                    <div class="flex items-center justify-between mb-5 flex-wrap gap-3">
                        <div class="flex items-center gap-3">
                            <!-- Drag handle -->
                            <i class="pi pi-bars text-surface-600 dark:text-surface-400 cursor-move" aria-label="Drag Handle" cdkDragHandle></i>
                            <div class="flex flex-col">
                                <h6 class="!text-xl !m-0">{{ section.title }}</h6>
                                <div class="flex items-center gap-2 flex-wrap">
                                    <p-badge value="{{ typeOption.label }}" [severity]="typeOption.severity" class="text-sm mb-1 w-fit"></p-badge>
                                    <span class="text-muted-color text-sm">{{ section.items.length }} item{{ section.items.length === 1 ? '' : 's' }} • </span>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center gap-2 flex-wrap">
                            <p-tag [severity]="status.severity" class="text-sm">{{ status.label }}</p-tag>
                            <p-button icon="pi pi-plus" label="Agregar item" (click)="openDialogItem(section)"></p-button>
                            <p-button icon="pi pi-pencil" text (click)="openDialogAndEdit(section)"></p-button>
                            <p-button icon="pi pi-trash" text severity="danger"></p-button>
                        </div>
                    </div>

                    @if (section.items.length > 0) {
                    <p-fieldset styleClass="dark:!bg-surface-800 dark:!border-surface-700" legend="Contenido" [toggleable]="true">
                        @if(section.type === SectionType.HERO) {
                        <section-hero-item [sectionItems]="section.items" (onSelectSectionItem)="openDialogItem(section, $event)"></section-hero-item>

                        } @else {

                        <div class="mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-y-4 gap-x-12">
                            @for (item of section.items; track item.id) {
                            <section-item [sectionItem]="item" (onSelectSectionItem)="openDialogItem(section, item)"></section-item>
                            }
                        </div>
                        }
                    </p-fieldset>

                    }
                </div>
                }
            </div>
            }
        </div>

        <section-item-form [display]="displayItemDialog()" (onCloseDialog)="displayItemDialog.set(false)" [selectedSectionItem]="selectedSectionItem()" [selectedSection]="currentSection()"></section-item-form>
    </ng-template>
</app-error-boundary>

} @else {
<div class="alert alert-info" style="text-align: center; margin-top: 2rem">
    <h2>Seleccione una página</h2>
    <p>Por favor, elija una página de la lista para ver su contenido.</p>
</div>
}
